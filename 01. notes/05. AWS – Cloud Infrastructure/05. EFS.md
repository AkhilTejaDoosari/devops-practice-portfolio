# Day 10 â€“ Elastic File System (EFS)

## Table of Contents

1. [Why We Need EFS](#1-why-we-need-efs)
2. [What Is Amazon EFS](#2-what-is-amazon-efs)
3. [EBS vs EFS vs S3 Comparison](#3-ebs-vs-efs-vs-s3-comparison)
4. [Simplified Real-World Scenarios](#4-simplified-real-world-scenarios)
5. [How EFS Works Internally](#5-how-efs-works-internally)
6. [Lab Task â€“ Mounting EFS on EC2](#6-lab-task--mounting-efs-on-ec2)
7. [Architecture Diagrams](#7-architecture-diagrams)
8. [Performance & Throughput Modes](#8-performance--throughput-modes)
9. [Pricing & Best Practices](#10-pricing--best-practices)

---

<details>
<summary><strong>1. Why We Need EFS</strong></summary>

When you start with one EC2, its **EBS volume** (local SSD) works fine.
But once you add more serversâ€”**EC2-A**, **EC2-B**, **EC2-C**â€”each has its own EBS disk.
Uploads on one server never appear on the others, creating inconsistent data.

You canâ€™t attach one EBS to many EC2s, and syncing files manually is painful.
What you really need is a **shared drive** that all EC2s can mount and see the same files instantly.
Thatâ€™s what **Amazon EFS** provides.

---

### ğŸ’¡ Quick Analogy

| Storage | Real-World Equivalent  | Use                        |
| ------- | ---------------------- | -------------------------- |
| **EBS** | Laptop SSD             | Private, local, fast       |
| **EFS** | Office network drive   | Shared, live, auto-scaling |
| **S3**  | Google Drive / Dropbox | Cloud archive and delivery |

EFS is that shared folder in the office everyone opens together.

---

### What EFS Fixes

| Need                  | Why EBS Fails            | How EFS Solves It           |
| --------------------- | ------------------------ | --------------------------- |
| Multi-instance access | EBS = 1 EC2 only         | EFS mountable by many EC2s  |
| Elastic capacity      | EBS size is fixed        | EFS auto-grows/shrinks      |
| High availability     | EBS in 1 AZ              | EFS replicates across AZs   |
| POSIX file system     | S3 = objects, no folders | EFS = real Linux filesystem |

---

### Visual Flow

```
Without EFS:
EC2-A â†’ EBS-A   âŒ Files not visible to EC2-B
EC2-B â†’ EBS-B   âŒ Different copies everywhere

With EFS:
EC2-A, EC2-B, EC2-C  â†’  mount /efsdir â†’  Amazon EFS
âœ“ All see and edit the same files in real time
```

---

### âœ… When to Use EFS

* Web apps on multiple EC2s (WordPress, Drupal)
* Shared datasets or ML pipelines
* Developer workspaces and user home dirs
* Any situation needing simultaneous read/write access

### âŒ Not for

* Databases â†’ use **EBS**
* Backups or global media hosting â†’ use **S3**

</details>

---

<details>
<summary><strong>2. What Is Amazon EFS</strong></summary>

**Amazon EFS (Elastic File System)** is a fully managed, shared file system that your EC2 instances can mount and use together.
It behaves like a normal Linux directory but the files actually live in AWSâ€™s storage layer, not inside any one EC2.

**Key Points**

* **Elastic:** Storage automatically expands or shrinks with your data.
* **Shared:** Many EC2s can mount the same path at once.
* **POSIX-compliant:** Standard Linux permissions, folders, and file locks work normally.
* **Highly Available:** Data is replicated across multiple AZs for durability.
* **Fully Managed:** No disks or capacity planningâ€”AWS handles scaling and health.

```
EC2-A, EC2-B, EC2-C  â”€â”€â–º  /efsdir  â”€â”€â–º  Amazon EFS (Shared Storage)
```

ğŸ’¡ **Think of it:** one central folder in the cloud that all your servers can open at the same time.

</details>

---

<details>
<summary><strong>3. EBS vs EFS vs S3 â€“ Storage Comparison</strong></summary>

AWS gives three main storage options, each solving a different need.

| Feature         | **EBS**                | **EFS**                    | **S3**                   |
| --------------- | ---------------------- | -------------------------- | ------------------------ |
| **Type**        | Block Storage          | File Storage               | Object Storage           |
| **Access**      | One EC2 at a time      | Many EC2s at once          | Via HTTP/API             |
| **Scalability** | Fixed size (manual)    | Auto-scales (elastic)      | Infinite                 |
| **Speed**       | Very fast (local disk) | Network fast               | Slower (API calls)       |
| **Use Case**    | OS disk, DB storage    | Shared app files / uploads | Backups, media, archives |
| **Scope**       | Single AZ              | Multi-AZ (Regional)        | Regional/Global          |
| **Analogy**     | Laptop SSD             | Office shared drive        | Google Drive / Dropbox   |

ğŸ’¡ **In short:**

* **EBS** â†’ local, private, single-server speed.
* **EFS** â†’ shared, elastic workspace for multiple servers.
* **S3** â†’ global storage for large, static, or archived data.

</details>

---

<details>
<summary><strong>4. Simplified Real-World Scenarios</strong></summary>

| Example                    | Storage Type | Real-World Analogy             | Key Idea                 |
| -------------------------- | ------------ | ------------------------------ | ------------------------ |
| **Personal Laptop**        | EBS          | Your own SSD â€“ only you use it | Local, fast, private     |
| **Office Shared Folder**   | EFS          | Team drive on company network  | Shared live access       |
| **Google Drive / Dropbox** | S3           | Cloud backup for everything    | Accessible from anywhere |

ğŸ¬ **Movie Studio Analogy**

| Task                      | Best AWS Storage | Why                               |
| ------------------------- | ---------------- | --------------------------------- |
| Editing raw footage       | EBS              | Local speed needed                |
| Sharing project files     | EFS              | Multiple editors collaborate live |
| Archiving finished movies | S3               | Cheap & limitless storage         |
| Streaming worldwide       | S3 + CloudFront  | Global delivery                   |

</details>

---

<details>
<summary><strong>5. How EFS Works Internally</strong></summary>

EFS isnâ€™t a physical disk; itâ€™s a **network file system** managed by AWS.
Your EC2s connect to it over **NFS (Network File System)** â€” just like mapping a shared drive in an office network.

### Step-by-Step Flow

1ï¸âƒ£ **Create EFS File System** â†’ AWS sets up an elastic backend across multiple AZs.
2ï¸âƒ£ **Mount Targets in Subnets** â†’ Each AZ gets an endpoint that EC2s use to connect.
3ï¸âƒ£ **Mount from EC2** â†’ You make a folder (`/efsdir`) and mount the EFS through NFS:

```bash
sudo mount -t efs -o tls <EFS_ID>:/ efsdir
```

4ï¸âƒ£ **Shared Access** â†’ Any EC2 mounting that same path sees identical files instantly.
5ï¸âƒ£ **Elastic Scaling & Durability** â†’ EFS automatically grows, shrinks, and replicates data across AZs.

---

### Visual Snapshot

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ AWS Region â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  EC2-A (AZ-A)  â”€â”                                           â”‚
â”‚                 â”‚   NFS Mount (tcp 2049)                    â”‚
â”‚  EC2-B (AZ-B)  â”€â”¼â”€â”€â–º  Amazon EFS File System                â”‚
â”‚  EC2-C (AZ-C)  â”€â”˜      â€¢ Multi-AZ replication               â”‚
â”‚                       â€¢ Auto-scale storage                  â”‚
â”‚                       â€¢ Shared POSIX filesystem             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ğŸ’¡ **In short:**
Your EC2s keep their own EBS disks for local speed but share one EFS folder for collaboration â€” all while AWS handles the scaling, replication, and reliability behind the scenes.  
ğŸ“˜ EFS is separate from EBS.  
Mounting EFS simply adds **another drive** to your machine (shared via network).
</details>

---

<details>
<summary><strong>6. Lab Task â€“ Mounting EFS on EC2</strong></summary>

**Goal:** Share the same storage between two EC2 instances.
###  **EFS Mount Lab (Quick Commands)**

```bash
# 1ï¸âƒ£ Launch two EC2 instances in the same VPC (different subnets for HA)

# 2ï¸âƒ£ Create an EFS file system in the AWS Console
#    â†’ Add mount targets in both subnets

# 3ï¸âƒ£ Connect to the first EC2
ssh -i mykey.pem ec2-user@<EC2-PUBLIC-IP>

# 4ï¸âƒ£ Install the EFS client
sudo yum install -y amazon-efs-utils

# 5ï¸âƒ£ Create a directory to mount EFS
mkdir /efsdir

# 6ï¸âƒ£ Mount the EFS file system
sudo mount -t efs -o tls <EFS-ID>:/ /efsdir

# 7ï¸âƒ£ Test shared access
echo "Hello from EC2-A" > /efsdir/test.txt
```

### âœ… **On EC2-B**

```bash
sudo yum install -y amazon-efs-utils
mkdir /efsdir
sudo mount -t efs -o tls <EFS-ID>:/ /efsdir
cat /efsdir/test.txt
```

If you see

```
Hello from EC2-A
```

EFS is successfully shared between both EC2 instances.

âœ… If both instances see the same file, EFS is working.
```
EC2-A (AZ-A) â”€â”
               â”œâ”€â”€â–º  Amazon EFS (File System)
EC2-B (AZ-B) â”€â”˜
     â†³ Both read / write to /efsdir (same files, live sync)
```
</details>

---

<details>
<summary><strong>7. Architecture Diagrams</strong></summary>

### A) Mount Flow (what your EC2 actually sees)

```
EC2 Instance
â”œâ”€ /           â†’ EBS (OS, app, local files)
â””â”€ /efsdir     â†’ EFS (shared network filesystem via NFS)
                 â†‘
                 â””â”€ mount -t efs <EFS-ID>:/ /efsdir
```

---

### B) Multi-AZ EFS with Mount Targets (HA)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ AWS Region â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VPC                                               â”‚
â”‚                                                    â”‚
â”‚  AZ-A                         AZ-B                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  EC2-A        â”‚           â”‚  EC2-B        â”‚     â”‚
â”‚  â”‚  (has EBS)    â”‚           â”‚  (has EBS)    â”‚     â”‚
â”‚  â”‚ mount /efsdir â”œâ”€â”€â”     â”Œâ”€â”€â”¤ mount /efsdir â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                     â–¼     â–¼                        â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚          â”‚  Amazon EFS (Regional)    â”‚             â”‚
â”‚          â”‚  â€¢ Multi-AZ replication   â”‚             â”‚
â”‚          â”‚  â€¢ Elastic capacity       â”‚             â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                  â–²     â”‚     â–²                     â”‚
â”‚     Mount Target (AZ-A)â”‚  Mount Target (AZ-B)      â”‚
â”‚        (one per subnet) (TCP 2049/NFS)             â”‚
â”‚                                                    â”‚
â”‚ Security Group tip:                                â”‚
â”‚ allow NFS (TCP 2049) EC2 â†” EFS (both directions)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### C) EFS in the App Tier (behind an ALB, optional context)

```
Internet
   â”‚
[ ALB ]  â† (optional) balances traffic to web/app EC2s
   â”‚
   â”œâ”€â”€ EC2-Web-1 (EBS) â”
   â”œâ”€â”€ EC2-Web-2 (EBS) â”¼â”€â”€ mount /efsdir â†’ Amazon EFS (shared content)
   â””â”€â”€ EC2-Web-3 (EBS) â”˜
```

---

### Final All-in-One (EBS + EFS + S3)

```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚         Amazon S3         â”‚
                â”‚  (Backups / Hosting / CDN)â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚  (HTTP/API)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            AWS VPC                             â”‚
â”‚                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        NFS (TCP 2049)       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  EC2-A        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚            â”‚ â”‚
â”‚   â”‚  (EBS: OS/app)â”‚                             â”‚            â”‚ â”‚
â”‚   â”‚  /efsdir â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  Amazon    â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚    EFS     â”‚ â”‚
â”‚                                                 â”‚ (Regional  â”‚ â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚  shared FS)â”‚ â”‚
â”‚   â”‚  EC2-B        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚            â”‚ â”‚
â”‚   â”‚  (EBS: OS/app)â”‚                             â”‚            â”‚ â”‚
â”‚   â”‚  /efsdir      â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚     
â”‚                                                                â”‚
â”‚  Flow:                                                         â”‚
â”‚   â€¢ EBS = local per-instance disk (fast, private)              â”‚
â”‚   â€¢ EFS = shared live files across EC2s                        â”‚
â”‚   â€¢ S3  = publish/archive/fan delivery (global)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

</details>

---

<details>
<summary><strong>8. Performance & Throughput Modes</strong></summary>

| Category        | Mode            | Description                      | Use Case                   |
| --------------- | --------------- | -------------------------------- | -------------------------- |
| **Performance** | General Purpose | Low latency (default)            | Web apps, CMS, dev/test    |
|                 | Max IO          | High throughput (bigger latency) | Big data, media processing |
| **Throughput**  | Bursting        | Scales with usage                | Variable workloads         |
|                 | Provisioned     | Fixed MB/s                       | Predictable heavy loads    |

</details>

---

<details>
<summary><strong>9. Pricing & Best Practices</strong></summary>

ğŸ’° **Pricing**

* Pay per GB of data stored per month.
* Lifecycle policy to move cold data to **EFS Infrequent Access (IA)**.
* No charge for data transfer within same Region.

âœ… **Best Practices**

* Allow TCP 2049 (NFS) in Security Groups.
* Enable encryption at rest and in transit.
* Create mount targets in each AZ for HA.
* Monitor EFS metrics via CloudWatch.
* Use lifecycle policies for cost optimization.

---

### ğŸ Final Summary

| **Concept** | **Acts Like** | **Main Use** |
|--------------|---------------|--------------|
| **EBS** | Laptop SSD (internal storage) | Fast, local storage for a single EC2 |
| **EFS** | Office network drive (shared external storage) | Shared, elastic multi-EC2 storage |
| **S3** | Google Drive / Dropbox | Global, limitless object storage for backups and hosting |

ğŸ’¡ **In one line:**  
> **EBS** is *personal and local*, **EFS** is *shared and elastic*, and **S3** is *global and endless*.

</details>
---